/*
 * cupertino-css — Apple-aesthetic UI components as a Tailwind CSS plugin
 * https://github.com/newlix/cupertino-css
 *
 * Usage:
 *   @import "tailwindcss";
 *   @import "cupertino-css";
 */

/* ─── Dark mode variant ─── */
@custom-variant dark (&:is(.dark *));

/* ─── CSS Variables ─── */
:root {
  --primary: oklch(0.563 0.193 256.16);        /* Apple Blue #0071E3 rgb(0,113,227) */
  --primary-hover: oklch(0.522 0.177 255.84);   /* #0066CC rgb(0,102,204) */
  --primary-active: oklch(0.480 0.165 256.16);  /* darker press state */
  --primary-foreground: #fff;

  --background: #fff;
  --foreground: oklch(0.232 0.004 285.99);      /* #1D1D1F Apple body text */

  --card: #fff;
  --card-foreground: oklch(0.232 0.004 285.99);

  --secondary: oklch(0.971 0.003 285.66);       /* #F5F5F7 Apple secondary bg */
  --secondary-hover: oklch(0.930 0.005 286.02);
  --secondary-foreground: oklch(0.232 0.004 285.99);

  --muted: oklch(0.971 0.003 285.66);
  --muted-foreground: oklch(0.540 0.008 286.01); /* #6E6E73 Apple muted text */

  --accent: oklch(0.971 0.003 285.66);
  --accent-foreground: oklch(0.232 0.004 285.99);

  --border: oklch(0.862 0.007 286.02 / 0.6);   /* #D1D1D6 Apple border */
  --border-solid: oklch(0.862 0.007 286.02 / 0.8);
  --input: oklch(0.862 0.007 286.02 / 0.8);

  --ring: oklch(0.563 0.193 256.16 / 0.1);

  --destructive: oklch(0.577 0.245 27.33);      /* red-500 */
  --destructive-hover: oklch(0.535 0.241 27.33); /* red-600 */
  --destructive-active: oklch(0.494 0.226 27.33);/* red-700 */
  --destructive-foreground: #fff;

  --success: oklch(0.596 0.172 145.18);          /* green-500 */
  --success-bg: oklch(0.962 0.044 156.74);       /* green-50 */
  --success-text: oklch(0.408 0.132 145.18);     /* green-700 */
  --success-border: oklch(0.905 0.093 156.74 / 0.6); /* green-200/60 */

  --warning: oklch(0.666 0.179 58.32);           /* amber-600 */
  --warning-bg: oklch(0.987 0.046 85.80);        /* amber-50 */
  --warning-text: oklch(0.461 0.147 58.32);      /* amber-700 */
  --warning-border: oklch(0.924 0.112 85.80 / 0.6); /* amber-200/60 */

  --info: oklch(0.563 0.193 256.16);             /* same as primary */
  --info-bg: oklch(0.563 0.193 256.16 / 0.05);
  --info-text: oklch(0.563 0.193 256.16);
  --info-border: oklch(0.563 0.193 256.16 / 0.2);

  --input-border: oklch(0.800 0.007 286.02);       /* Apple input border */
  --input-border-hover: oklch(0.580 0.010 286.01); /* Darker on hover */

  --apple-press-scale: 0.98;
  --apple-spring: cubic-bezier(0.2, 0.8, 0.2, 1);
  --apple-ease: cubic-bezier(0.25, 0.1, 0.25, 1);

  /* Surface overlays — auto-switch in dark mode */
  --surface-1: oklch(0 0 0 / 0.02);    /* table header, zebra stripe */
  --surface-2: oklch(0 0 0 / 0.03);    /* hover backgrounds */
  --surface-3: oklch(0 0 0 / 0.04);    /* icon bg, kbd bg, toggle group */
  --surface-4: oklch(0 0 0 / 0.06);    /* active state, segmented control bg */
  --surface-5: oklch(0 0 0 / 0.1);     /* slider track */
  --surface-6: oklch(0 0 0 / 0.12);    /* scrollbar */
  --surface-7: oklch(0 0 0 / 0.2);     /* scrollbar hover, handle */
  --panel-border: oklch(0 0 0 / 0.06); /* section dividers in panels */
  --panel-ring: 0 0 0 1px oklch(0 0 0 / 0.04); /* card/table shadow outline */
  --float-ring: 0 0 0 1px oklch(0 0 0 / 0.06); /* dropdown/popover/toast outline */
  --glass-blur: blur(20px) saturate(1.5);
  --glass-bg: oklch(from var(--card) l c h / 0.85);
  --glass-bg-opaque: oklch(from var(--card) l c h / 0.9);
  --backdrop-bg: oklch(0 0 0 / 0.35);

  --radius: 0.75rem;                             /* 12px */
  --radius-sm: 0.5rem;                           /* 8px */
  --radius-lg: 1rem;                             /* 16px */
  --radius-xl: 1.375rem;                         /* 22px */

  --shadow-sm: 0 1px 2px oklch(0 0 0 / 0.04), 0 1px 3px oklch(0 0 0 / 0.03);
  --shadow: 0 2px 8px oklch(0 0 0 / 0.06), 0 1px 2px oklch(0 0 0 / 0.04);
  --shadow-md: 0 4px 16px oklch(0 0 0 / 0.08), 0 2px 4px oklch(0 0 0 / 0.04);
  --shadow-lg: 0 8px 32px oklch(0 0 0 / 0.1), 0 2px 8px oklch(0 0 0 / 0.05);
  --shadow-xl: 0 16px 48px oklch(0 0 0 / 0.12), 0 4px 16px oklch(0 0 0 / 0.06);
}

.dark {
  --primary: oklch(0.669 0.181 251.85);          /* #2997FF Apple blue on dark bg */
  --primary-hover: oklch(0.620 0.185 253.00);
  --primary-active: oklch(0.570 0.188 254.00);

  --background: oklch(0.000 0 0);                /* #000 Apple dark bg */
  --foreground: oklch(0.971 0.003 285.66);       /* #F5F5F7 Apple dark text */

  --card: oklch(0.160 0.004 285.99);             /* #1C1C1E Apple dark card */
  --card-foreground: oklch(0.971 0.003 285.66);

  --secondary: oklch(0.232 0.004 285.99);        /* #2C2C2E Apple dark secondary */
  --secondary-hover: oklch(0.320 0.004 285.99);
  --secondary-foreground: oklch(0.971 0.003 285.66);

  --muted: oklch(0.232 0.004 285.99);
  --muted-foreground: oklch(0.630 0.006 286.01); /* #98989D Apple dark muted */

  --accent: oklch(0.232 0.004 285.99);
  --accent-foreground: oklch(0.971 0.003 285.66);

  --border: oklch(0.290 0.004 285.99);           /* #3A3A3C Apple dark border */
  --border-solid: oklch(0.350 0.004 285.99);     /* #48484A */
  --input: oklch(0.350 0.004 285.99);

  --input-border: oklch(0.350 0.004 285.99);       /* #48484A */
  --input-border-hover: oklch(0.420 0.004 285.99); /* Lighter on hover */

  --ring: oklch(0.669 0.181 251.85 / 0.2);

  --info: oklch(0.669 0.181 251.85);
  --info-bg: oklch(0.669 0.181 251.85 / 0.05);
  --info-text: oklch(0.669 0.181 251.85);
  --info-border: oklch(0.669 0.181 251.85 / 0.2);

  --success-bg: oklch(0.596 0.172 145.18 / 0.05);
  --success-text: oklch(0.792 0.155 145.18);    /* green-400 */
  --success-border: oklch(0.596 0.172 145.18 / 0.2);

  --warning-bg: oklch(0.666 0.179 58.32 / 0.05);
  --warning-text: oklch(0.828 0.143 58.32);     /* amber-400 */
  --warning-border: oklch(0.666 0.179 58.32 / 0.2);

  --shadow-sm: 0 1px 3px oklch(1 0 0 / 0.08), 0 1px 2px oklch(1 0 0 / 0.04);
  --shadow: 0 2px 8px oklch(0 0 0 / 0.2), 0 1px 3px oklch(0 0 0 / 0.15);
  --shadow-md: 0 4px 16px oklch(0 0 0 / 0.25), 0 2px 4px oklch(0 0 0 / 0.15);
  --shadow-lg: 0 8px 32px oklch(0 0 0 / 0.3), 0 2px 8px oklch(0 0 0 / 0.2);
  --shadow-xl: 0 16px 48px oklch(0 0 0 / 0.35), 0 4px 16px oklch(0 0 0 / 0.2);

  --surface-1: oklch(1 0 0 / 0.03);
  --surface-2: oklch(1 0 0 / 0.05);
  --surface-3: oklch(1 0 0 / 0.06);
  --surface-4: oklch(1 0 0 / 0.08);
  --surface-5: oklch(1 0 0 / 0.12);
  --surface-6: oklch(1 0 0 / 0.12);
  --surface-7: oklch(1 0 0 / 0.2);
  --panel-border: oklch(1 0 0 / 0.08);
  --panel-ring: 0 0 0 1px oklch(1 0 0 / 0.06);
  --float-ring: 0 0 0 1px oklch(1 0 0 / 0.08);
  --glass-bg: oklch(from var(--card) l c h / 0.8);
  --glass-bg-opaque: oklch(from var(--card) l c h / 0.85);
}

/* ─── Theme tokens (make vars available to Tailwind) ─── */
@theme {
  --color-primary: var(--primary);
  --color-primary-hover: var(--primary-hover);
  --color-primary-active: var(--primary-active);
  --color-primary-foreground: var(--primary-foreground);
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-hover: var(--secondary-hover);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
  --color-destructive: var(--destructive);
  --color-destructive-hover: var(--destructive-hover);
  --color-destructive-active: var(--destructive-active);
  --color-destructive-foreground: var(--destructive-foreground);
  --color-success: var(--success);
  --color-success-bg: var(--success-bg);
  --color-success-text: var(--success-text);
  --color-success-border: var(--success-border);
  --color-warning: var(--warning);
  --color-warning-bg: var(--warning-bg);
  --color-warning-text: var(--warning-text);
  --color-warning-border: var(--warning-border);
  --color-info: var(--info);
  --color-info-bg: var(--info-bg);
  --color-info-text: var(--info-text);
  --color-info-border: var(--info-border);
  --radius: var(--radius);
  --radius-sm: var(--radius-sm);
  --radius-lg: var(--radius-lg);
  --radius-xl: var(--radius-xl);
  --shadow-sm: var(--shadow-sm);
  --shadow: var(--shadow);
  --shadow-md: var(--shadow-md);
  --shadow-lg: var(--shadow-lg);
  --shadow-xl: var(--shadow-xl);
}

/* ─── Base ─── */
@layer base {
  body {
    @apply bg-background text-foreground antialiased;
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", system-ui, sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    letter-spacing: -0.01em;
  }

  *,
  *::before,
  *::after {
    @apply border-border;
  }

  @keyframes slideUp {
    from { opacity: 0; transform: translateY(8px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  @keyframes slideDown {
    from { opacity: 1; transform: translateY(0); }
    to   { opacity: 0; transform: translateY(8px); }
  }

  @keyframes dialogShow {
    from { opacity: 0; transform: scale(0.95); }
    to   { opacity: 1; transform: scale(1); }
  }

  @keyframes indeterminate {
    0%   { transform: translateX(-100%); }
    100% { transform: translateX(400%); }
  }

  @keyframes sheetSlideInRight {
    from { transform: translateX(100%); }
    to   { transform: translateX(0); }
  }

  @keyframes sheetSlideInLeft {
    from { transform: translateX(-100%); }
    to   { transform: translateX(0); }
  }

  @keyframes sheetSlideInBottom {
    from { transform: translateY(100%); }
    to   { transform: translateY(0); }
  }

  @keyframes sheetSlideInTop {
    from { transform: translateY(-100%); }
    to   { transform: translateY(0); }
  }
}

/* ─── Components ─── */
@layer components {

  /* ========== BUTTON ========== */
  .btn,
  .btn-primary,
  .btn-secondary,
  .btn-outline,
  .btn-ghost,
  .btn-destructive {
    @apply inline-flex items-center justify-center gap-2 rounded-[10px] px-4 py-2.5 text-[13px] font-medium disabled:pointer-events-none disabled:opacity-50 cursor-pointer;
    transition: all 0.25s var(--apple-spring);
    letter-spacing: -0.01em;
    &:active { transform: scale(var(--apple-press-scale)); }
  }
  .btn-primary {
    @apply bg-primary text-primary-foreground;
    box-shadow: var(--shadow-sm), inset 0 1px 0 oklch(1 0 0 / 0.1);
    &:hover { @apply bg-primary-hover; box-shadow: var(--shadow), inset 0 1px 0 oklch(1 0 0 / 0.1); }
    &:active { @apply bg-primary-active; transform: scale(var(--apple-press-scale)); }
  }
  /* Default .btn alone = primary style (exclude color variants, not size/shape modifiers) */
  .btn:not(.btn-primary, .btn-secondary, .btn-outline, .btn-ghost, .btn-destructive, .btn-icon) {
    @apply bg-primary text-primary-foreground;
    box-shadow: var(--shadow-sm), inset 0 1px 0 oklch(1 0 0 / 0.1);
    &:hover { @apply bg-primary-hover; box-shadow: var(--shadow), inset 0 1px 0 oklch(1 0 0 / 0.1); }
    &:active { @apply bg-primary-active; }
  }
  .btn-secondary {
    @apply bg-secondary text-secondary-foreground;
    &:hover { background: var(--secondary-hover); }
  }
  .btn-outline {
    @apply border bg-card text-card-foreground;
    border-color: var(--border-solid);
    box-shadow: var(--shadow-sm);
    &:hover { background: oklch(0.985 0.002 286.32); box-shadow: var(--shadow); }
    &:is(.dark *) {
      &:hover { @apply bg-accent; }
    }
  }
  .btn-ghost {
    @apply text-foreground;
    &:hover { @apply bg-secondary; }
  }
  .btn-destructive {
    @apply bg-destructive text-destructive-foreground;
    box-shadow: var(--shadow-sm);
    &:hover { @apply bg-destructive-hover; box-shadow: var(--shadow); }
    &:active { @apply bg-destructive-active; transform: scale(var(--apple-press-scale)); }
  }
  .btn-pill {
    @apply rounded-full px-5;
  }
  .btn-sm {
    @apply px-3.5 py-1.5 text-xs gap-1.5;
  }
  .btn-lg {
    @apply px-6 py-3 text-base;
  }
  .btn-icon {
    @apply size-9 p-0 rounded-full bg-secondary text-muted-foreground;
    &:hover { background: var(--secondary-hover); }
  }

  /* ========== BADGE ========== */
  .badge,
  .badge-primary,
  .badge-secondary,
  .badge-success,
  .badge-warning,
  .badge-destructive,
  .badge-outline {
    @apply inline-flex items-center gap-1 rounded-full px-2.5 py-[3px] text-xs font-medium bg-secondary text-secondary-foreground;
    letter-spacing: 0;
  }
  /* Only text carries semantic color */
  .badge-primary    { @apply text-primary; }
  .badge-success    { color: oklch(0.596 0.172 145.18); }
  .badge-warning    { color: oklch(0.666 0.179 58.32); }
  .badge-destructive { @apply text-destructive; }
  .badge-outline {
    @apply bg-transparent;
    box-shadow: inset 0 0 0 1px var(--border-solid);
  }

  /* ========== CARD ========== */
  .card {
    @apply rounded-2xl bg-card text-card-foreground;
    box-shadow: var(--shadow), var(--panel-ring);
    & > header {
      @apply px-6 py-5;
      border-bottom: 1px solid var(--panel-border);
      & h2, & h3 { @apply text-[17px] font-semibold tracking-tight; }
      & p { @apply mt-0.5 text-[13px] text-muted-foreground; }
    }
    & > section {
      @apply px-6 py-5;
    }
    & > footer {
      @apply px-6 py-4;
      border-top: 1px solid var(--panel-border);
    }
    /* Basic card without header/section/footer = padded */
    &:not(:has(header)):not(:has(section)) {
      @apply p-6;
      & h2, & h3 { @apply text-[17px] font-semibold tracking-tight; }
      & p { @apply mt-1.5 text-[13px] text-muted-foreground; }
    }
  }
  .card-interactive {
    @apply rounded-2xl bg-card p-6 text-card-foreground cursor-pointer;
    box-shadow: var(--shadow), var(--panel-ring);
    transition: all 0.3s var(--apple-spring);
    & h2, & h3 { @apply text-[17px] font-semibold tracking-tight; }
    & p { @apply mt-1.5 text-[13px] text-muted-foreground; }
    &:hover {
      box-shadow: var(--shadow-md), var(--float-ring);
      transform: translateY(-1px);
    }
    &:active { transform: translateY(0) scale(var(--apple-press-scale)); }
  }

  /* ========== ALERT ========== */
  .alert,
  .alert-info,
  .alert-success,
  .alert-warning,
  .alert-destructive {
    @apply flex gap-3 rounded-xl p-4;
    background: var(--card);
    box-shadow: var(--shadow-sm), var(--panel-ring);
    & svg:first-child { @apply mt-0.5 size-5 shrink-0; color: var(--muted-foreground); }
    & p:first-child, & p:first-of-type { @apply text-[13px] font-medium text-foreground; }
    & p:last-child:not(:first-child) { @apply mt-0.5 text-[13px] text-muted-foreground; }
  }
  /* Only the icon carries semantic color */
  .alert-info    { & svg:first-child { color: var(--primary); } }
  .alert-success { & svg:first-child { color: oklch(0.596 0.172 145.18); } }
  .alert-warning { & svg:first-child { color: oklch(0.666 0.179 58.32); } }
  .alert-destructive { & svg:first-child { color: var(--destructive); } }

  /* ========== FORM CONTROLS (shared base) ========== */
  .input,
  .textarea,
  .select,
  .field > input:not([type="checkbox"]):not([type="radio"]),
  .field > textarea,
  .field > select {
    @apply w-full rounded-[12px] border text-[13px] text-foreground outline-none;
    background-color: var(--card);
    transition: border-color 0.2s var(--apple-ease);
    &::placeholder { @apply text-muted-foreground; opacity: 0.45; }
    &:focus {
      border-color: var(--primary);
    }
    &:disabled { @apply cursor-not-allowed opacity-50; }
  }
  /* Text inputs + textareas share border behavior */
  .input,
  .textarea,
  .field > input:not([type="checkbox"]):not([type="radio"]),
  .field > textarea {
    border-color: var(--input-border);
    &:hover:not(:focus) { border-color: var(--input-border-hover); }
  }
  /* Input sizing */
  .input,
  .field > input:not([type="checkbox"]):not([type="radio"]) {
    @apply h-11 px-3.5;
  }
  /* Textarea sizing */
  .textarea,
  .field > textarea {
    @apply px-3.5 py-3;
  }
  /* Select sizing + chevron */
  .select,
  .field > select {
    @apply h-11 appearance-none pl-3.5 pr-10;
    border-color: var(--input);
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%239ca3af' stroke-width='2'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.75rem center;
    background-size: 1rem;
    &:hover:not(:focus) { border-color: var(--border-solid); }
  }
  /* Error states */
  .input[aria-invalid="true"], .input.input-error,
  .textarea[aria-invalid="true"], .textarea.textarea-error,
  .field > input[aria-invalid="true"], .field > input.input-error {
    border-color: var(--destructive);
    &:focus {
      border-color: var(--destructive);
    }
  }

  /* ========== CHECKBOX ========== */
  .checkbox {
    @apply appearance-none size-[18px] shrink-0 rounded-[5px] border bg-card cursor-pointer;
    border-color: var(--input-border);
    transition: all 0.2s var(--apple-ease);
    &:checked {
      @apply bg-primary border-primary;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='white' stroke-width='3'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M5 13l4 4L19 7'/%3E%3C/svg%3E");
      background-size: 12px;
      background-position: center;
      background-repeat: no-repeat;
    }
    &:hover:not(:focus-visible) { border-color: var(--input-border-hover); }
    &:focus-visible { box-shadow: 0 0 0 4px oklch(from var(--primary) l c h / 0.15); }
    &:disabled { @apply cursor-not-allowed opacity-50; }
  }

  /* ========== RADIO ========== */
  .radio {
    @apply appearance-none size-[18px] shrink-0 rounded-full border bg-card cursor-pointer;
    border-color: var(--input-border);
    transition: all 0.2s var(--apple-ease);
    &:checked {
      border-color: var(--primary);
      border-width: 5px;
    }
    &:hover:not(:focus-visible) { border-color: var(--input-border-hover); }
    &:focus-visible { box-shadow: 0 0 0 4px oklch(from var(--primary) l c h / 0.15); }
    &:disabled { @apply cursor-not-allowed opacity-50; }
  }

  /* ========== SWITCH ========== */
  .switch {
    @apply appearance-none relative shrink-0 rounded-full cursor-pointer;
    width: 51px;
    height: 31px;
    background: oklch(0.862 0.007 286.02);
    transition: background-color 0.25s var(--apple-ease);
    &::after {
      content: "";
      @apply absolute rounded-full bg-white;
      top: 2px;
      left: 2px;
      width: 27px;
      height: 27px;
      box-shadow: 0 2px 4px oklch(0 0 0 / 0.15), 0 1px 2px oklch(0 0 0 / 0.1);
      transition: transform 0.25s var(--apple-spring);
    }
    &:checked {
      background: oklch(0.647 0.177 145.18); /* Apple Green #34C759 */
      &::after { transform: translateX(20px); }
    }
    &:focus-visible { box-shadow: 0 0 0 4px oklch(from var(--primary) l c h / 0.15); }
    &:disabled { @apply cursor-not-allowed opacity-50; }
    &:is(.dark *) {
      background: oklch(0.350 0.004 285.99);
      &:checked { background: oklch(0.596 0.172 145.18); /* slightly darker green in dark */ }
    }
  }

  /* ========== LABEL ========== */
  .label {
    @apply block text-[13px] font-medium text-foreground;
  }

  /* ========== FIELD (auto-styles children — form controls inherited from shared base above) ========== */
  .field {
    @apply space-y-1.5;
    & > label { @apply text-[13px] font-medium text-foreground; }
    & > p { @apply text-xs text-muted-foreground; }
    & > p.field-error { color: var(--destructive); }
  }

  /* ========== DIALOG ========== */
  dialog.dialog,
  .dialog {
    @apply m-auto w-full max-w-md rounded-[20px] bg-card text-card-foreground p-0;
    box-shadow: var(--shadow-xl), var(--float-ring);
    &::backdrop {
      background: var(--backdrop-bg);
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
    }
    &[open] { animation: dialogShow 0.28s var(--apple-spring); }
    & > header {
      @apply px-6 pt-6;
      & h2 { @apply text-[17px] font-semibold tracking-tight text-foreground; }
      & p { @apply mt-1.5 text-[13px] text-muted-foreground; }
    }
    & > section {
      @apply px-6 pt-4;
    }
    & > footer {
      @apply flex justify-end gap-2 px-6 pb-6 pt-6;
    }
  }

  /* ========== DROPDOWN MENU ========== */
  .dropdown-menu {
    @apply absolute z-50 mt-1.5 hidden min-w-[200px] rounded-xl p-1.5;
    background: var(--glass-bg);
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
    box-shadow: var(--shadow-lg), var(--float-ring);
    & button, & a {
      @apply flex w-full items-center gap-2.5 rounded-[8px] px-3 py-2 text-left text-[13px] text-foreground;
      transition: background-color 0.12s var(--apple-ease);
      &:hover { @apply bg-accent; }
      & svg { @apply size-4 text-muted-foreground; }
    }
    & .dropdown-divider, & hr {
      @apply my-1 h-px mx-1.5;
      background: var(--panel-border);
    }
    & .dropdown-destructive {
      color: var(--destructive);
      &:hover { background: oklch(0.577 0.245 27.33 / 0.08); }
      &:is(.dark *) {
        color: oklch(0.792 0.198 27.33);
        &:hover { background: oklch(0.577 0.245 27.33 / 0.12); }
      }
    }
  }

  /* ========== TABS ========== */
  .tabs {
    /* wrapper */
  }
  .tabs-list {
    @apply flex;
    border-bottom: 1px solid var(--panel-border);
  }
  .tabs-trigger {
    @apply relative px-4 py-2.5 text-[13px] font-medium text-muted-foreground cursor-pointer;
    transition: color 0.2s var(--apple-ease);
    &:hover { @apply text-foreground; }
    &[data-active] {
      color: var(--primary);
      &::after {
        content: "";
        @apply absolute bottom-0 left-0 h-0.5 w-full;
        border-radius: 1px 1px 0 0;
        background: var(--primary);
      }
    }
  }
  .tabs-content {
    @apply py-4;
    &:not([data-active]) { @apply hidden; }
  }
  /* Pill variant — Apple segmented control */
  .tabs-pill {
    & .tabs-list {
      @apply inline-flex rounded-[10px] border-0 p-1;
      background: var(--surface-4);
    }
    & .tabs-trigger {
      @apply rounded-[7px] px-3.5 py-1.5 text-[13px];
      transition: all 0.2s var(--apple-spring);
      &[data-active] {
        @apply text-foreground;
        background: var(--card);
        box-shadow: var(--shadow-sm);
        &::after { display: none; }
      }
    }
  }

  /* ========== TABLE ========== */
  .table {
    @apply overflow-hidden rounded-2xl bg-card;
    box-shadow: var(--shadow-sm), var(--panel-ring);
    & table {
      @apply w-full text-left text-[13px];
    }
    & thead tr {
      border-bottom: 1px solid var(--panel-border);
      background: var(--surface-1);
    }
    & th {
      @apply px-4 py-3 text-xs font-semibold text-muted-foreground;
    }
    & tbody {
      & tr + tr {
        border-top: 1px solid var(--surface-3);
      }
    }
    & td {
      @apply px-4 py-3;
    }
    & tbody tr {
      transition: background-color 0.15s var(--apple-ease);
      &:hover {
        background: var(--surface-1);
      }
    }
  }
  .table-striped {
    & tbody tr:hover { background: inherit; }
    & tbody tr:nth-child(even) {
      background: var(--surface-1);
    }
  }

  /* ========== ACCORDION ========== */
  .accordion {
    @apply rounded-2xl bg-card;
    box-shadow: var(--shadow-sm), var(--panel-ring);
    & details + details {
      border-top: 1px solid var(--panel-border);
    }
    & summary {
      @apply flex cursor-pointer items-center justify-between px-5 py-4 text-[13px] font-medium text-foreground;
      transition: background-color 0.15s var(--apple-ease);
      &:hover { background: var(--surface-1); }
      &::-webkit-details-marker { display: none; }
      & svg:last-child {
        @apply size-4 shrink-0 text-muted-foreground;
        transition: transform 0.25s var(--apple-spring);
      }
    }
    & details:first-child > summary {
      @apply rounded-t-2xl;
    }
    & details:last-child:not([open]) > summary {
      @apply rounded-b-2xl;
    }
    & details[open] > summary svg:last-child {
      transform: rotate(180deg);
    }
    & details > div, & details > p {
      @apply px-5 pb-4 text-[13px] text-muted-foreground;
    }
  }

  /* ========== AVATAR ========== */
  .avatar {
    @apply inline-flex size-10 items-center justify-center rounded-full text-[13px] font-semibold;
    /* Default fallback styling */
    @apply bg-secondary text-muted-foreground;
    & img {
      @apply size-full rounded-full object-cover;
    }
  }
  .avatar-sm { @apply size-8 text-xs; }
  .avatar-lg { @apply size-14 text-[17px]; }
  .avatar-group {
    @apply flex -space-x-2;
    & .avatar {
      @apply ring-2 ring-background;
    }
  }

  /* ========== BREADCRUMB ========== */
  .breadcrumb {
    @apply flex items-center gap-1.5 text-[13px];
    & a {
      @apply text-muted-foreground transition-colors;
      &:hover { @apply text-foreground; }
    }
    & svg { @apply size-3.5 text-muted-foreground; opacity: 0.6; }
    & span:last-child, & [aria-current] {
      @apply font-medium text-foreground;
    }
    & .breadcrumb-separator {
      @apply text-muted-foreground; opacity: 0.6;
    }
  }

  /* ========== BUTTON GROUP ========== */
  .button-group {
    @apply inline-flex rounded-[10px] bg-card;
    box-shadow: 0 0 0 1px var(--panel-border), var(--shadow-sm);
    & button, & a {
      @apply inline-flex items-center justify-center bg-transparent px-4 py-2.5 text-[13px] font-medium text-foreground;
      transition: all 0.15s var(--apple-ease);
      &:hover { background: var(--surface-2); }
      &:first-child { @apply rounded-l-[10px]; }
      &:last-child { @apply rounded-r-[10px]; }
      &:not(:first-child) {
        border-left: 1px solid var(--panel-border);
      }
      &[data-active] {
        @apply bg-primary text-primary-foreground;
        &:hover { @apply bg-primary-hover; }
      }
    }
  }

  /* ========== KBD ========== */
  .kbd {
    @apply inline-flex h-5 min-w-5 items-center justify-center rounded-[5px] px-1.5 text-[11px] font-medium text-muted-foreground;
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
    background: var(--surface-3);
    box-shadow: 0 1px 0 var(--panel-border), var(--float-ring);
  }

  /* ========== PAGINATION ========== */
  .pagination {
    @apply flex items-center gap-0.5;
  }
  .pagination-item {
    @apply inline-flex size-9 items-center justify-center rounded-[10px] text-[13px] font-medium text-muted-foreground cursor-pointer;
    transition: all 0.2s var(--apple-ease);
    &:hover { background: var(--surface-3); }
    &[data-active] {
      @apply bg-primary text-primary-foreground;
      box-shadow: var(--shadow-sm);
    }
    &:disabled { @apply pointer-events-none opacity-50; }
  }

  /* ========== PROGRESS ========== */
  .progress {
    @apply h-1.5 w-full overflow-hidden rounded-full;
    background: var(--surface-4);
    & .progress-bar {
      @apply h-full rounded-full bg-primary;
      transition: width 0.5s var(--apple-spring);
    }
  }
  .progress-sm {
    @apply h-1;
  }
  .progress-indeterminate {
    & .progress-bar {
      @apply w-1/3;
      animation: indeterminate 1.5s ease-in-out infinite;
    }
  }

  /* ========== SKELETON ========== */
  .skeleton,
  .skeleton-circle {
    @apply animate-pulse rounded-lg;
    background: var(--surface-4);
  }
  .skeleton-circle {
    @apply rounded-full;
  }

  /* ========== SLIDER ========== */
  .slider {
    @apply w-full cursor-pointer appearance-none rounded-full;
    height: 4px;
    background: var(--surface-5);
    accent-color: var(--primary);
    &::-webkit-slider-thumb {
      @apply appearance-none rounded-full bg-white;
      width: 22px;
      height: 22px;
      box-shadow: 0 1px 4px oklch(0 0 0 / 0.15), 0 0 0 1px oklch(0 0 0 / 0.04);
      transition: box-shadow 0.2s var(--apple-ease), transform 0.2s var(--apple-ease);
    }
    &::-webkit-slider-thumb:hover {
      box-shadow: 0 2px 8px oklch(0 0 0 / 0.2), 0 0 0 1px oklch(0 0 0 / 0.04);
      transform: scale(1.05);
    }
    &::-webkit-slider-thumb:active {
      box-shadow: 0 1px 3px oklch(0 0 0 / 0.2), 0 0 0 1px oklch(0 0 0 / 0.04);
      transform: scale(0.95);
    }
    &::-moz-range-thumb {
      @apply rounded-full bg-white;
      width: 22px;
      height: 22px;
      border: none;
      box-shadow: 0 1px 4px oklch(0 0 0 / 0.15), 0 0 0 1px oklch(0 0 0 / 0.04);
    }
  }

  /* ========== SPINNER ========== */
  .spinner {
    @apply size-5 animate-spin text-primary;
    & circle { opacity: 0.25; }
    & path { opacity: 0.75; }
  }
  .spinner-sm { @apply size-4; }
  .spinner-lg { @apply size-8; }

  /* ========== TOAST ========== */
  .toast {
    @apply flex w-80 items-start gap-3 rounded-2xl p-4;
    background: var(--glass-bg-opaque);
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
    box-shadow: var(--shadow-lg), var(--float-ring);
    animation: slideUp 0.3s var(--apple-spring);
    & svg:first-child { @apply mt-0.5 size-5 shrink-0; }
    & .toast-title { @apply text-[13px] font-semibold text-foreground; }
    & .toast-message { @apply mt-0.5 text-[13px] text-muted-foreground; }
    & .toast-close {
      @apply shrink-0 text-muted-foreground cursor-pointer;
      transition: color 0.15s var(--apple-ease);
      &:hover { @apply text-foreground; }
      & svg { @apply size-4; }
    }
  }
  .toast-container {
    @apply fixed bottom-4 right-4 z-[100] flex flex-col gap-2.5;
  }

  /* ========== TOOLTIP ========== */
  .tooltip {
    @apply relative inline-block;
  }
  .tooltip-content {
    @apply pointer-events-none absolute bottom-full left-1/2 mb-2 -translate-x-1/2 whitespace-nowrap rounded-lg px-3 py-1.5 text-xs font-medium;
    background: oklch(0.200 0.004 285.99);
    color: white;
    box-shadow: var(--shadow-md);
    opacity: 0;
    transform: translateX(-50%) translateY(2px);
    transition: opacity 0.15s var(--apple-ease), transform 0.15s var(--apple-ease);
    .tooltip:hover > & {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    &::after {
      content: "";
      @apply absolute left-1/2 top-full -translate-x-1/2;
      border: 4px solid transparent;
      border-top-color: oklch(0.200 0.004 285.99);
    }
    &:is(.dark *) {
      background: oklch(0.940 0.003 285.66);
      color: oklch(0.200 0.004 285.99);
      &::after { border-top-color: oklch(0.940 0.003 285.66); }
    }
  }
  .tooltip-bottom {
    & .tooltip-content {
      @apply bottom-auto top-full mb-0 mt-2;
      transform: translateX(-50%) translateY(-2px);
      .tooltip:hover > & { transform: translateX(-50%) translateY(0); }
      &::after {
        @apply top-auto bottom-full;
        border-top-color: transparent;
        border-bottom-color: oklch(0.200 0.004 285.99);
        &:is(.dark *) {
          border-bottom-color: oklch(0.940 0.003 285.66);
        }
      }
    }
  }

  .tooltip-right {
    & .tooltip-content {
      @apply bottom-auto left-full top-1/2 mb-0 ml-2 -translate-y-1/2 translate-x-0;
      transform: translateY(-50%) translateX(-2px);
      .tooltip:hover > & { transform: translateY(-50%) translateX(0); }
      &::after {
        @apply left-auto right-full top-1/2 -translate-y-1/2;
        border-top-color: transparent;
        border-right-color: oklch(0.200 0.004 285.99);
        &:is(.dark *) {
          border-right-color: oklch(0.940 0.003 285.66);
        }
      }
    }
  }
  .tooltip-left {
    & .tooltip-content {
      @apply bottom-auto right-full left-auto top-1/2 mb-0 mr-2 -translate-y-1/2 translate-x-0;
      transform: translateY(-50%) translateX(2px);
      .tooltip:hover > & { transform: translateY(-50%) translateX(0); }
      &::after {
        @apply right-auto left-full top-1/2 -translate-y-1/2;
        border-top-color: transparent;
        border-left-color: oklch(0.200 0.004 285.99);
        &:is(.dark *) {
          border-left-color: oklch(0.940 0.003 285.66);
        }
      }
    }
  }

  /* ========== SEPARATOR ========== */
  .separator {
    @apply shrink-0;
    background: var(--panel-border);
  }
  .separator:not(.separator-vertical) {
    @apply h-px w-full;
  }
  .separator-vertical {
    @apply w-px self-stretch;
  }
  .separator-label {
    @apply flex items-center gap-3 text-xs text-muted-foreground;
    &::before, &::after {
      content: "";
      @apply h-px flex-1;
      background: var(--panel-border);
    }
  }

  /* ========== INPUT GROUP ========== */
  .input-group {
    @apply relative;
    & .input-group-icon {
      @apply absolute top-1/2 -translate-y-1/2 pointer-events-none text-muted-foreground;
      & svg { @apply size-4; }
    }
    & .input-group-icon-left {
      @apply left-3;
    }
    & .input-group-icon-right {
      @apply right-3;
    }
    & .input-group-text {
      @apply absolute top-1/2 -translate-y-1/2 pointer-events-none text-muted-foreground text-[13px];
    }
    & .input-group-text-left {
      @apply left-3;
    }
    & .input-group-text-right {
      @apply right-3;
    }
  }
  .input-group-attached {
    @apply flex items-stretch;
    & .input-group-addon {
      @apply flex items-center border px-3 text-[13px] text-muted-foreground;
      background: var(--muted);
    }
    & .input-group-addon:first-child {
      @apply rounded-l-xl border-r-0;
    }
    & .input-group-addon:last-child {
      @apply rounded-r-xl border-l-0;
    }
    & .input, & input {
      @apply flex-1;
    }
    & .input:not(:first-child):not(:last-child), & input:not(:first-child):not(:last-child) {
      @apply rounded-none;
    }
    & .input:first-child, & input:first-child {
      @apply rounded-r-none;
    }
    & .input:last-child, & input:last-child {
      @apply rounded-l-none;
    }
  }

  /* ========== ITEM ========== */
  .item {
    @apply flex items-center gap-4 rounded-2xl p-4 text-[13px];
    transition: background-color 0.15s var(--apple-ease);
    & .item-icon {
      @apply flex size-9 shrink-0 items-center justify-center rounded-[10px] text-muted-foreground;
      background: var(--surface-3);
      & svg { @apply size-4; }
    }
    & .item-avatar {
      @apply size-10 shrink-0 rounded-full object-cover;
    }
    & .item-content {
      @apply flex flex-1 flex-col gap-0.5;
      & h3 { @apply text-[13px] font-medium leading-snug; }
      & p { @apply text-[13px] text-muted-foreground; }
    }
    & .item-action {
      @apply flex items-center gap-2 text-muted-foreground;
      & svg { @apply size-4; }
    }
  }
  .item-outline {
    box-shadow: var(--float-ring);
  }
  .item-muted {
    background: var(--surface-1);
  }
  a.item, button.item {
    @apply cursor-pointer;
    &:hover {
      background: var(--surface-2);
    }
  }
  .item-group {
    @apply flex flex-col rounded-2xl bg-card;
    box-shadow: var(--shadow-sm), var(--panel-ring);
    & .item { @apply rounded-none; }
    & .item:first-child { @apply rounded-t-2xl; }
    & .item:last-child { @apply rounded-b-2xl; }
    & .item + .item {
      border-top: 1px solid var(--surface-3);
    }
  }

  /* ========== FORM ========== */
  .fieldset {
    @apply flex flex-col gap-5;
    & legend {
      @apply w-full text-base font-semibold tracking-tight text-foreground;
      letter-spacing: -0.01em;
      float: left;
    }
    & legend + p {
      @apply mt-1 text-[13px] text-muted-foreground;
    }
    & hr {
      background: var(--panel-border);
    }
  }

  /* ========== SIDEBAR ========== */
  .sidebar {
    @apply fixed left-0 top-0 flex h-full w-[260px] flex-col;
    background: var(--glass-bg);
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
    border-right: 1px solid var(--panel-border);
    & .sidebar-header {
      @apply flex items-center gap-2.5 px-5 py-4;
      border-bottom: 1px solid var(--panel-border);
      & h2 { @apply text-[13px] font-semibold tracking-tight; }
    }
    & .sidebar-content {
      @apply flex-1 overflow-y-auto px-3 py-3;
    }
    & .sidebar-section {
      @apply mb-4;
      & h3 { @apply mb-1 px-2 text-[11px] font-semibold text-muted-foreground; }
    }
    & .sidebar-item {
      @apply flex items-center gap-2.5 rounded-lg px-2.5 py-2 text-[13px] text-foreground/70 cursor-pointer;
      transition: all 0.15s var(--apple-ease);
      & svg { @apply size-4 text-muted-foreground; }
      &:hover { background: var(--surface-3); @apply text-foreground; }
      &[data-active] { background: var(--surface-4); @apply text-foreground font-medium; }
    }
    & .sidebar-footer {
      @apply px-5 py-4;
      border-top: 1px solid var(--panel-border);
    }
  }

  /* ========== THEME SWITCHER ========== */
  .theme-switcher {
    @apply inline-flex items-center rounded-[10px] p-0.5;
    background: var(--surface-4);
    & button {
      @apply flex size-8 items-center justify-center rounded-[7px] text-muted-foreground cursor-pointer;
      transition: all 0.2s var(--apple-spring);
      & svg { @apply size-4; }
      &:hover { @apply text-foreground; }
      &[data-active] {
        @apply text-foreground;
        background: var(--card);
        box-shadow: var(--shadow-sm);
      }
    }
  }

  /* ========== COMMAND ========== */
  .command {
    @apply flex flex-col rounded-2xl bg-card overflow-hidden;
    box-shadow: var(--shadow-lg), var(--float-ring);
    & > header {
      @apply flex items-center gap-2 px-3.5;
      border-bottom: 1px solid var(--panel-border);
      & svg { @apply size-4 shrink-0 text-muted-foreground; }
      & input {
        @apply h-12 flex-1 bg-transparent text-[13px] text-foreground outline-none;
        &::placeholder { @apply text-muted-foreground; opacity: 0.45; }
      }
    }
    & [role="menu"], & [role="listbox"] {
      @apply max-h-72 overflow-y-auto p-1.5;
      & [role="group"] {
        & > [role="heading"], & > span[role="heading"] {
          @apply block px-2.5 py-1.5 text-[11px] font-semibold text-muted-foreground;
        }
      }
      & [role="menuitem"], & [role="option"] {
        @apply flex items-center gap-2.5 rounded-[8px] px-2.5 py-2 text-[13px] text-foreground cursor-pointer;
        transition: background-color 0.12s var(--apple-ease);
        & svg { @apply size-4 shrink-0 text-muted-foreground; }
        & span { @apply flex-1; }
        &:hover { @apply bg-accent; }
        &[data-active] { @apply bg-accent; }
        &[aria-disabled="true"] { @apply opacity-50 pointer-events-none; }
        &[data-selected]::before {
          content: "";
          display: inline-block;
          width: 1rem; height: 1rem;
          background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor' stroke-width='2.5'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M5 13l4 4L19 7'/%3E%3C/svg%3E");
          background-size: contain;
          background-repeat: no-repeat;
          flex-shrink: 0;
        }
      }
      & hr[role="separator"], & hr {
        @apply my-1 h-px;
        background: var(--secondary);
      }
      &.command-empty::after {
        content: attr(data-empty);
        @apply block py-6 text-center text-[13px] text-muted-foreground;
      }
    }
  }
  dialog.command-dialog,
  .command-dialog {
    @apply m-auto w-full max-w-lg rounded-[20px] border-0 bg-transparent p-0;
    box-shadow: var(--shadow-xl);
    &::backdrop {
      background: var(--backdrop-bg);
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
    }
    &[open] { animation: dialogShow 0.25s var(--apple-spring); }
    & > .command {
      box-shadow: none;
      border: 1px solid var(--panel-border);
    }
  }

  /* ========== COMBOBOX ========== */
  .combobox {
    @apply relative inline-block;
    & > button {
      @apply flex h-11 items-center justify-between gap-2 rounded-[12px] border px-3.5 text-[13px] transition-all duration-200 cursor-pointer;
      background-color: var(--card);
      border-color: var(--input);
      &:hover:not(:focus) { border-color: var(--border-solid); }
      & span { @apply flex-1 truncate text-left; }
      & span[data-placeholder] { @apply text-muted-foreground; opacity: 0.5; }
      & svg { @apply size-4 shrink-0 text-muted-foreground opacity-50; }
    }
    & [data-combobox-content] {
      @apply absolute z-50 mt-1.5 hidden w-full min-w-[200px] rounded-xl overflow-hidden;
      background: var(--glass-bg-opaque);
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
      box-shadow: var(--shadow-lg), var(--float-ring);
      animation: slideUp 0.2s var(--apple-spring);
      & > header {
        @apply flex items-center gap-2 border-b px-3;
        & svg { @apply size-4 shrink-0 text-muted-foreground; }
        & input {
          @apply h-10 flex-1 bg-transparent text-[13px] text-foreground outline-none;
          &::placeholder { @apply text-muted-foreground; opacity: 0.5; }
        }
      }
      & [role="listbox"] {
        @apply max-h-56 overflow-y-auto p-1;
        & [role="group"] {
          & > [role="heading"] {
            @apply block px-2 py-1.5 text-xs font-medium text-muted-foreground;
          }
        }
        & [role="option"] {
          @apply flex items-center gap-2 rounded-lg px-2 py-2 text-[13px] text-foreground cursor-pointer transition-colors;
          & svg { @apply size-4 shrink-0 text-muted-foreground; }
          &:hover { @apply bg-accent; }
          &[data-active] { @apply bg-accent; }
          &[data-selected] {
            @apply bg-accent font-medium;
            &::after {
              content: "";
              display: inline-block;
              width: 1rem; height: 1rem; margin-left: auto;
              background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor' stroke-width='2.5'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M5 13l4 4L19 7'/%3E%3C/svg%3E");
              background-size: contain;
              background-repeat: no-repeat;
              flex-shrink: 0;
            }
          }
        }
        & hr[role="separator"], & hr {
          @apply my-1 h-px;
          background: var(--secondary);
        }
        &.combobox-empty::after {
          content: attr(data-empty);
          @apply block py-6 text-center text-[13px] text-muted-foreground;
        }
      }
    }
    &[data-open] > [data-combobox-content] {
      @apply block;
    }
  }

  /* ========== EMPTY ========== */
  .empty {
    @apply flex min-w-0 flex-1 flex-col items-center justify-center gap-3 rounded-2xl p-10 text-center text-balance;
    & .empty-icon {
      @apply mb-1 flex size-14 shrink-0 items-center justify-center rounded-2xl text-muted-foreground;
      background: var(--surface-3);
      & svg { @apply size-6; }
    }
    & h3 { @apply text-[17px] font-semibold tracking-tight text-foreground; }
    & p { @apply text-[13px] text-muted-foreground; max-width: 28ch; }
    & .empty-actions { @apply mt-3 flex gap-2; }
  }

  /* ========== COLLAPSIBLE ========== */
  .collapsible {
    @apply rounded-2xl bg-card;
    box-shadow: var(--shadow-sm), var(--panel-ring);
    & summary {
      @apply flex cursor-pointer list-none items-center justify-between rounded-2xl px-5 py-4 text-[13px] font-medium text-foreground;
      transition: background-color 0.15s var(--apple-ease);
      &:hover { background: var(--surface-1); }
      &::-webkit-details-marker { display: none; }
      & svg:last-child {
        @apply size-4 shrink-0 text-muted-foreground;
        transition: transform 0.25s var(--apple-spring);
      }
    }
    &[open] > summary {
      @apply rounded-b-none;
    }
    &[open] > summary svg:last-child {
      transform: rotate(180deg);
    }
    & > div, & > p {
      @apply px-5 pb-4 text-[13px] text-muted-foreground;
    }
  }

  /* ========== FILE TREE ========== */
  .file-tree {
    @apply rounded-2xl bg-card;
    box-shadow: var(--shadow-sm), var(--panel-ring);

    & summary {
      list-style: none;
      cursor: pointer;
      &::-webkit-details-marker { display: none; }
    }

    /* Root header */
    & > summary {
      @apply flex items-center justify-between rounded-2xl px-4 py-3 text-[13px] font-medium text-foreground;
      transition: background-color 0.15s var(--apple-ease);
      &:hover { background: var(--surface-1); }
    }
    &[open] > summary { @apply rounded-b-none; }

    /* Tree body */
    & > div {
      @apply p-2;

      & summary {
        @apply flex items-center gap-1.5 rounded-lg px-2 py-1 text-[13px] text-foreground;
        transition: background-color 0.15s var(--apple-ease);
        &:hover { background: var(--surface-2); }
        & > svg { @apply size-4 shrink-0 text-muted-foreground; }
      }

      & .file-tree-chevron {
        @apply size-3.5 shrink-0 text-muted-foreground;
        transition: transform 0.2s var(--apple-ease);
      }
      & details[open] > summary > .file-tree-chevron {
        transform: rotate(90deg);
      }

      /* 12px per nesting level (Xcode-like density) */
      & details > div { @apply pl-3; }
    }

    /* File item */
    & .file-tree-item {
      @apply flex cursor-pointer items-center gap-1.5 rounded-lg py-1 pr-2 text-[13px] text-muted-foreground;
      padding-left: 1.75rem; /* aligns file icon with folder icon: px-2 + chevron + gap */
      transition: background-color 0.15s var(--apple-ease);
      &:hover { background: var(--surface-2); }
      & > svg { @apply size-4 shrink-0; }
    }
  }

  /* ========== SHEET ========== */
  dialog.sheet,
  .sheet {
    @apply fixed m-0 h-full bg-card text-card-foreground;
    max-height: 100vh;
    max-width: min(420px, 85vw);
    box-shadow: var(--shadow-xl);
    &::backdrop {
      background: var(--backdrop-bg);
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
    }
    &[open] { animation: sheetSlideIn 0.35s var(--apple-spring); }
    /* Right (default) */
    &:not(.sheet-left) {
      @apply right-0 top-0;
      border-left: 1px solid var(--panel-border);
      &[open] { animation-name: sheetSlideInRight; }
    }
    /* Left */
    &.sheet-left {
      @apply left-0 top-0;
      border-right: 1px solid var(--panel-border);
      &[open] { animation-name: sheetSlideInLeft; }
    }
    & > header {
      @apply px-6 py-5;
      border-bottom: 1px solid var(--panel-border);
      & h2 { @apply text-[17px] font-semibold tracking-tight text-foreground; }
      & p { @apply mt-1 text-[13px] text-muted-foreground; }
    }
    & > section {
      @apply overflow-y-auto px-6 py-5;
    }
    & > footer {
      @apply px-6 py-4;
      border-top: 1px solid var(--panel-border);
    }
    & .sheet-close {
      @apply absolute right-4 top-4 rounded-full p-1.5 text-muted-foreground cursor-pointer;
      transition: all 0.2s var(--apple-ease);
      &:hover { @apply text-foreground bg-accent; }
      & svg { @apply size-4; }
    }
  }

  /* ========== POPOVER ========== */
  .popover {
    @apply relative inline-block;
  }
  .popover-content {
    @apply absolute z-50 mt-2 hidden min-w-[220px] rounded-2xl p-4;
    background: var(--glass-bg-opaque);
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
    box-shadow: var(--shadow-lg), var(--float-ring);
    animation: slideUp 0.2s var(--apple-spring);
    &.popover-open {
      @apply block;
    }
  }
  .popover-top {
    & .popover-content {
      @apply bottom-full top-auto mb-2 mt-0;
    }
  }

  /* ========== TOGGLE ========== */
  .toggle {
    @apply inline-flex size-9 items-center justify-center rounded-[8px] text-muted-foreground cursor-pointer;
    transition: all 0.2s var(--apple-ease);
    &:hover {
      @apply text-foreground;
      background: var(--surface-3);
    }
    &:active { transform: scale(var(--apple-press-scale)); }
    &[data-active], &[aria-pressed="true"] {
      @apply text-foreground;
      background: var(--surface-4);
    }
    &:disabled, &[disabled] { @apply pointer-events-none opacity-50; }
    & svg { @apply size-4; }
  }
  .toggle-sm { @apply size-8; & svg { @apply size-3.5; } }
  .toggle-lg { @apply size-10; & svg { @apply size-5; } }
  .toggle-outline {
    box-shadow: inset 0 0 0 1px var(--border-solid);
    &[data-active], &[aria-pressed="true"] {
      @apply text-primary;
      background: oklch(from var(--primary) l c h / 0.06);
      box-shadow: inset 0 0 0 1px oklch(from var(--primary) l c h / 0.2);
    }
  }
  .toggle-group {
    @apply inline-flex items-center gap-0.5 rounded-[10px] p-0.5;
    background: var(--surface-3);
    & .toggle {
      @apply rounded-[7px];
    }
  }

  /* ========== ASPECT RATIO ========== */
  .aspect-ratio {
    @apply relative overflow-hidden rounded-xl;
    & > img, & > video {
      @apply absolute inset-0 h-full w-full object-cover;
    }
  }

  /* ========== TYPOGRAPHY (PROSE) ========== */
  .prose {
    @apply max-w-[65ch] text-foreground;
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
    font-size: 17px;
    line-height: 1.47;
    letter-spacing: -0.015em;
    & > * + * { @apply mt-5; }
    & h1 {
      @apply font-bold tracking-tight text-foreground;
      font-size: 34px;
      line-height: 1.21;
      &:not(:first-child) { @apply mt-12; }
    }
    & h2 {
      @apply font-semibold tracking-tight text-foreground;
      font-size: 22px;
      line-height: 1.18;
      &:not(:first-child) { @apply mt-10; }
    }
    & h3 {
      @apply font-semibold tracking-tight text-foreground;
      font-size: 20px;
      line-height: 1.25;
      &:not(:first-child) { @apply mt-8; }
    }
    & h4 {
      @apply font-semibold text-foreground;
      font-size: 17px;
      line-height: 1.29;
      &:not(:first-child) { @apply mt-6; }
    }
    & .lead {
      @apply text-xl text-muted-foreground;
      line-height: 1.4;
    }
    & .muted {
      @apply text-[13px] text-muted-foreground;
    }
    & blockquote {
      @apply border-l-2 pl-5 italic text-muted-foreground;
      border-color: var(--border-solid);
    }
    & ul {
      @apply list-disc pl-6 space-y-1.5;
    }
    & ol {
      @apply list-decimal pl-6 space-y-1.5;
    }
    & li {
      & > ul, & > ol { @apply mt-1.5; }
    }
    & code {
      @apply rounded-md bg-secondary px-1.5 py-0.5 text-[13px] font-medium;
    }
    & pre {
      @apply overflow-x-auto rounded-xl bg-secondary p-4;
      & code {
        @apply bg-transparent p-0;
      }
    }
    & hr {
      @apply my-8;
      border-color: var(--border);
    }
    & table {
      @apply w-full text-[13px];
      & th {
        @apply border-b px-4 py-2 text-left font-semibold;
        border-color: var(--border-solid);
      }
      & td {
        @apply border-b px-4 py-2;
        border-color: var(--border);
      }
    }
    & a {
      @apply font-medium text-primary underline underline-offset-4;
      &:hover { text-decoration-color: var(--primary); }
    }
    & img {
      @apply rounded-xl;
    }
  }

  /* ========== SCROLL AREA ========== */
  .scroll-area {
    overflow: auto;
    &::-webkit-scrollbar {
      width: 7px;
      height: 7px;
    }
    &::-webkit-scrollbar-track {
      background: transparent;
    }
    &::-webkit-scrollbar-thumb {
      border-radius: 9999px;
      background: var(--surface-6);
      border: 1px solid transparent;
      background-clip: content-box;
      &:hover { background: var(--surface-7); background-clip: content-box; }
    }
    scrollbar-width: thin;
    scrollbar-color: var(--surface-6) transparent;
  }
  .scroll-area-horizontal {
    overflow-x: auto;
    overflow-y: hidden;
  }

  /* ========== HOVER CARD ========== */
  .hover-card {
    @apply relative inline-block;
  }
  .hover-card-content {
    @apply pointer-events-none absolute z-50 mt-2 min-w-[280px] rounded-2xl p-4;
    background: var(--glass-bg-opaque);
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
    box-shadow: var(--shadow-lg), var(--float-ring);
    opacity: 0;
    transform: translateY(4px);
    transition: opacity 0.2s var(--apple-ease), transform 0.2s var(--apple-ease);
  }
  .hover-card:hover .hover-card-content {
    @apply pointer-events-auto;
    opacity: 1;
    transform: translateY(0);
  }
  .hover-card-bottom .hover-card-content {
    @apply bottom-auto top-full mt-2;
  }
  .hover-card-top .hover-card-content {
    @apply bottom-full top-auto mb-2 mt-0;
  }

  /* ========== DRAWER ========== */
  dialog.sheet-bottom,
  .sheet-bottom {
    @apply fixed bottom-0 left-0 right-0 top-auto m-0 w-full max-w-full bg-card text-card-foreground;
    max-height: min(85vh, 600px);
    border-radius: 20px 20px 0 0;
    box-shadow: 0 -8px 32px oklch(0 0 0 / 0.1), var(--float-ring);
    &::backdrop {
      background: var(--backdrop-bg);
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
    }
    &[open] { animation: sheetSlideInBottom 0.35s var(--apple-spring); }
    & > header {
      @apply px-6 py-5;
      & h2 { @apply text-[17px] font-semibold tracking-tight text-foreground; }
      & p { @apply mt-1 text-[13px] text-muted-foreground; }
    }
    & > section {
      @apply overflow-y-auto px-6 py-5;
    }
    & > footer {
      @apply px-6 py-4;
      border-top: 1px solid var(--panel-border);
    }
    & .sheet-close {
      @apply absolute right-4 top-4 rounded-full p-1.5 text-muted-foreground cursor-pointer;
      transition: all 0.2s var(--apple-ease);
      &:hover { @apply text-foreground bg-accent; }
      & svg { @apply size-4; }
    }
    & .drawer-handle {
      @apply mx-auto mt-2 mb-1 h-1 w-9 rounded-full;
      background: var(--surface-7);
    }
  }
  dialog.sheet-top,
  .sheet-top {
    @apply fixed top-0 left-0 right-0 bottom-auto m-0 w-full max-w-full bg-card text-card-foreground;
    max-height: min(85vh, 600px);
    border-radius: 0 0 20px 20px;
    box-shadow: 0 8px 32px oklch(0 0 0 / 0.1), var(--float-ring);
    &::backdrop {
      background: var(--backdrop-bg);
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
    }
    &[open] { animation: sheetSlideInTop 0.35s var(--apple-spring); }
    & > header {
      @apply px-6 py-5;
      & h2 { @apply text-[17px] font-semibold tracking-tight text-foreground; }
      & p { @apply mt-1 text-[13px] text-muted-foreground; }
    }
    & > section {
      @apply overflow-y-auto px-6 py-5;
    }
    & > footer {
      @apply px-6 py-4;
      border-top: 1px solid var(--panel-border);
    }
    & .sheet-close {
      @apply absolute right-4 top-4 rounded-full p-1.5 text-muted-foreground cursor-pointer;
      transition: all 0.2s var(--apple-ease);
      &:hover { @apply text-foreground bg-accent; }
      & svg { @apply size-4; }
    }
  }

  /* ========== INPUT OTP ========== */
  .input-otp {
    @apply flex items-center gap-2;
  }
  .input-otp-slot {
    @apply flex size-12 items-center justify-center rounded-[10px] border text-[17px] font-medium text-foreground;
    border-color: var(--input-border);
    caret-color: transparent;
    transition: border-color 0.2s var(--apple-ease);
    &:focus-within, &[data-active] {
      border-color: var(--primary);
    }
  }
  .input-otp-separator {
    @apply flex items-center text-muted-foreground;
    & span { @apply mx-0.5 text-xl; }
  }
  .input-otp[data-error] .input-otp-slot {
    border-color: var(--destructive);
    color: var(--destructive);
  }

  /* ========== CONTEXT MENU ========== */
  .context-menu-trigger {
    @apply cursor-default;
  }
  .context-menu-content {
    @apply fixed z-[9999] hidden min-w-[200px] rounded-xl p-1.5;
    background: var(--glass-bg);
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
    box-shadow: var(--shadow-lg), var(--float-ring);
    animation: slideUp 0.12s var(--apple-spring);
    & button, & a {
      @apply flex w-full items-center gap-2.5 rounded-[8px] px-3 py-2 text-left text-[13px] text-foreground;
      transition: background-color 0.12s var(--apple-ease);
      &:hover { @apply bg-accent; }
      & svg { @apply size-4 text-muted-foreground; }
    }
    & hr {
      @apply my-1 h-px mx-1.5;
      background: var(--panel-border);
    }
    & .context-menu-shortcut {
      @apply ml-auto text-xs text-muted-foreground;
    }
    &.open { @apply block; }
  }

  /* ========== CAROUSEL ========== */
  .carousel {
    @apply relative w-full;
  }
  .carousel-content {
    @apply flex gap-4 overflow-x-auto scroll-smooth;
    scroll-snap-type: x mandatory;
    scrollbar-width: none;
    &::-webkit-scrollbar { display: none; }
  }
  .carousel-item {
    @apply shrink-0;
    scroll-snap-align: start;
    width: calc(100% - 2rem);
  }
  .carousel-item-half {
    width: calc(50% - 0.5rem);
  }
  .carousel-item-third {
    width: calc(33.333% - 0.75rem);
  }
  .carousel-prev,
  .carousel-next {
    @apply absolute top-1/2 z-10 flex size-9 -translate-y-1/2 items-center justify-center rounded-full text-foreground cursor-pointer;
    background: var(--glass-bg);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    box-shadow: var(--shadow), var(--float-ring);
    transition: all 0.2s var(--apple-ease);
    &:hover { box-shadow: var(--shadow-md), var(--float-ring); }
    &:active { transform: translateY(-50%) scale(var(--apple-press-scale)); }
    &:disabled { @apply pointer-events-none opacity-30; }
    & svg { @apply size-4; }
  }
  .carousel-prev { @apply -left-3; }
  .carousel-next { @apply -right-3; }
  .carousel-indicators {
    @apply mt-4 flex items-center justify-center gap-1.5;
  }
  .carousel-indicator {
    @apply rounded-full cursor-pointer;
    width: 6px;
    height: 6px;
    background: oklch(from var(--foreground) l c h / 0.2);
    transition: all 0.3s var(--apple-spring);
    &[data-active] {
      background: oklch(from var(--foreground) l c h / 0.6);
      width: 1.5rem;
    }
  }
}
