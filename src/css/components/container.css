/* ========== CONTAINER ========== */
/* Wrap semantic HTML in .cider to auto-style native elements.
   .cider = pure element styling, no layout opinion.
   .cider-fixed = layout modifier — add alongside .cider for centered fixed-width breakpoints.
   .cider-reset = scope boundary — stops .cider styles from leaking into nested components.
   @scope ensures .cider styles stop at .cider-reset and .snippet > figure boundaries.
   Nested .cider inside a reset re-opens a new scope. */

/* ─── Layout ─── */
.cider-fixed {
  @apply mx-auto px-5 max-w-xl md:max-w-2xl lg:max-w-4xl xl:max-w-6xl;
}

@scope (.cider) to (.cider-reset, .snippet > figure) {

  /* ─── Typography ─── */
  :scope {
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
    font-size: 15px;
    line-height: 1.47;
    letter-spacing: -0.015em;
    color: var(--foreground);
  }
  h1 {
    @apply font-bold tracking-tight text-foreground;
    font-size: 34px;
    line-height: 1.21;
    &:not(:first-child) { @apply mt-8; }
    & + * { @apply mt-4; }
  }
  h2 {
    @apply font-semibold tracking-tight text-foreground;
    font-size: 22px;
    line-height: 1.18;
    &:not(:first-child) { @apply mt-8; }
    & + * { @apply mt-3; }
  }
  h3 {
    @apply font-semibold tracking-tight text-foreground;
    font-size: 20px;
    line-height: 1.25;
    &:not(:first-child) { @apply mt-6; }
    & + * { @apply mt-2; }
  }
  h4 {
    @apply font-semibold text-foreground;
    font-size: 17px;
    line-height: 1.29;
    &:not(:first-child) { @apply mt-4; }
  }
  p {
    & + p { @apply mt-4; }
  }
  a {
    @apply font-medium text-primary underline underline-offset-4;
    &:hover { text-decoration-color: var(--primary); }
    &:focus-visible { outline: 3px solid oklch(from var(--primary) l c h / 0.3); outline-offset: 2px; border-radius: 2px; }
  }
  ul {
    @apply list-disc pl-6 space-y-1.5;
  }
  ol {
    @apply list-decimal pl-6 space-y-1.5;
  }
  blockquote {
    @apply border-l-2 pl-5 italic text-muted-foreground;
    border-color: var(--border-solid);
  }
  code {
    @apply rounded-md bg-secondary px-1.5 py-0.5 font-mono text-[13px] font-medium;
  }

  /* ─── Buttons ─── */
  button {
    @apply inline-flex items-center justify-center gap-2 rounded-[12px] px-4 py-2.5 text-[13px] font-medium disabled:pointer-events-none disabled:opacity-50 cursor-pointer;
    transition: all 0.25s var(--apple-spring);
    letter-spacing: -0.01em;
    @apply bg-secondary text-secondary-foreground;
    &:hover { background: var(--secondary-hover); }
    &:active { transform: scale(var(--apple-press-scale)); }
    &:focus-visible { outline: 3px solid oklch(from var(--primary) l c h / 0.3); outline-offset: 2px; }
  }
  button[type="submit"] {
    @apply bg-primary text-primary-foreground;
    box-shadow: var(--shadow-sm), inset 0 1px 0 oklch(1 0 0 / 0.1);
    &:hover { @apply bg-primary-hover; box-shadow: var(--shadow), inset 0 1px 0 oklch(1 0 0 / 0.1); }
    &:active { @apply bg-primary-active; transform: scale(var(--apple-press-scale)); }
  }
  button[type="reset"] {
    @apply bg-transparent text-foreground;
    &:hover { @apply bg-secondary; }
  }

  /* ─── Text inputs ─── */
  input:not([type="checkbox"]):not([type="radio"]):not([type="range"]):not([type="file"]):not([type="submit"]):not([type="reset"]):not([type="button"]):not([type="image"]):not([type="hidden"]):not([role="switch"]) {
    @apply w-full h-11 rounded-[12px] border px-3.5 text-[13px] text-foreground outline-none;
    background-color: var(--card);
    border-color: var(--input-border);
    transition: border-color 0.2s var(--apple-ease);
    &::placeholder { @apply text-muted-foreground; opacity: 0.45; }
    &:hover:not(:focus) { border-color: var(--input-border-hover); }
    &:focus { border-color: var(--primary); }
    &:disabled { @apply cursor-not-allowed opacity-50; }
  }

  /* ─── Textarea ─── */
  textarea {
    @apply w-full rounded-[12px] border px-3.5 py-3 text-[13px] text-foreground outline-none;
    background-color: var(--card);
    border-color: var(--input-border);
    transition: border-color 0.2s var(--apple-ease);
    &::placeholder { @apply text-muted-foreground; opacity: 0.45; }
    &:hover:not(:focus) { border-color: var(--input-border-hover); }
    &:focus { border-color: var(--primary); }
    &:disabled { @apply cursor-not-allowed opacity-50; }
  }

  /* ─── Select ─── */
  select {
    @apply w-full h-11 rounded-[12px] border appearance-none pl-3.5 pr-10 text-[13px] text-foreground outline-none;
    background-color: var(--card);
    border-color: var(--input);
    transition: border-color 0.2s var(--apple-ease);
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236E6E73' stroke-width='2'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.75rem center;
    background-size: 1rem;
    &:is(.dark *) {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2398989D' stroke-width='2'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'/%3E%3C/svg%3E");
    }
    &:hover:not(:focus) { border-color: var(--border-solid); }
    &:focus { border-color: var(--primary); }
    &:disabled { @apply cursor-not-allowed opacity-50; }
  }

  /* ─── Checkbox ─── */
  input[type="checkbox"]:not([role="switch"]) {
    @apply appearance-none size-[18px] shrink-0 rounded-[5px] border bg-card cursor-pointer;
    border-color: var(--input-border);
    transition: all 0.2s var(--apple-ease);
    &:checked {
      @apply bg-primary border-primary;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='white' stroke-width='3'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M5 13l4 4L19 7'/%3E%3C/svg%3E");
      background-size: 12px;
      background-position: center;
      background-repeat: no-repeat;
    }
    &:hover:not(:focus-visible):not(:checked) { border-color: var(--input-border-hover); }
    &:focus-visible { box-shadow: 0 0 0 4px oklch(from var(--primary) l c h / 0.15); }
    &:disabled { @apply cursor-not-allowed opacity-50; }
  }

  /* ─── Radio ─── */
  input[type="radio"] {
    @apply appearance-none size-[18px] shrink-0 rounded-full border bg-card cursor-pointer;
    border-color: var(--input-border);
    transition: all 0.2s var(--apple-ease);
    &:checked {
      border-color: var(--primary);
      border-width: 5px;
    }
    &:hover:not(:focus-visible):not(:checked) { border-color: var(--input-border-hover); }
    &:focus-visible { box-shadow: 0 0 0 4px oklch(from var(--primary) l c h / 0.15); }
    &:disabled { @apply cursor-not-allowed opacity-50; }
  }

  /* ─── Switch ─── */
  input[type="checkbox"][role="switch"] {
    @apply appearance-none relative shrink-0 rounded-full cursor-pointer;
    width: 51px;
    height: 31px;
    background: oklch(0.862 0.007 286.02);
    transition: background-color 0.25s var(--apple-ease);
    &::after {
      content: "";
      @apply absolute rounded-full bg-white;
      top: 2px;
      left: 2px;
      width: 27px;
      height: 27px;
      box-shadow: 0 2px 4px oklch(0 0 0 / 0.15), 0 1px 2px oklch(0 0 0 / 0.1);
      transition: transform 0.25s var(--apple-spring);
    }
    &:checked {
      background: var(--primary);
      &::after { transform: translateX(20px); }
    }
    &:focus-visible { box-shadow: 0 0 0 4px oklch(from var(--primary) l c h / 0.15); }
    &:disabled { @apply cursor-not-allowed opacity-50; }
    &:is(.dark *) {
      background: oklch(0.350 0.004 285.99);
      &:checked { background: var(--primary); }
    }
  }

  /* ─── Label ─── */
  label {
    @apply block text-[13px] font-medium text-foreground;
  }

  /* ─── Table ─── */
  table {
    @apply w-full text-left text-[13px] overflow-x-auto rounded-2xl bg-card;
    box-shadow: var(--shadow-sm), var(--panel-ring);
    & thead tr {
      border-bottom: 1px solid var(--panel-border);
      background: var(--surface-1);
    }
    & th {
      @apply px-4 py-3 text-xs font-semibold text-muted-foreground;
    }
    & tbody tr + tr {
      border-top: 1px solid var(--surface-3);
    }
    & td {
      @apply px-4 py-3;
    }
    & tbody tr {
      transition: background-color 0.15s var(--apple-ease);
      &:hover { background: var(--surface-1); }
    }
    & tfoot tr {
      border-top: 1px solid var(--panel-border);
      background: var(--surface-1);
    }
  }

  /* ─── Separator (hr) ─── */
  hr {
    @apply shrink-0 h-px w-full border-none;
    background: var(--panel-border);
  }

  /* ─── Kbd ─── */
  kbd {
    @apply inline-flex h-5 min-w-5 items-center justify-center rounded-[5px] px-1.5 text-[11px] font-medium text-muted-foreground;
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
    background: var(--surface-3);
    box-shadow: 0 1px 0 var(--panel-border), var(--float-ring);
  }

  /* ─── Progress ─── */
  progress {
    @apply block h-1.5 w-full overflow-hidden rounded-full appearance-none;
    background: var(--surface-4);
    &::-webkit-progress-bar {
      background: var(--surface-4);
      border-radius: 9999px;
    }
    &::-webkit-progress-value {
      background: var(--primary);
      border-radius: 9999px;
      transition: width 0.5s var(--apple-spring);
    }
    &::-moz-progress-bar {
      background: var(--primary);
      border-radius: 9999px;
    }
  }

  /* ─── Fieldset ─── */
  fieldset {
    @apply rounded-2xl border p-5 space-y-4;
    border-color: var(--border);
    & > legend {
      @apply px-2 text-[13px] font-semibold text-foreground;
    }
  }

  /* ─── Small (helper text) ─── */
  small {
    @apply text-xs text-muted-foreground;
  }
}
