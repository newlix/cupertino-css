/* ========== CONTAINER ========== */
/* Wrap semantic HTML in .cider to auto-style native elements.
   .cider = pure element styling, no layout opinion.
   .cider-fixed = layout modifier — add alongside .cider for centered fixed-width breakpoints.
   .cider-reset = scope boundary — stops .cider styles from leaking into nested components.
   Parent @scope in ciderui.css ensures .cider styles stop at .cider-reset.
   Nested .cider inside a reset re-opens a new scope. */

/* ─── Layout ─── */
:scope.cider-fixed {
  @apply mx-auto px-5 max-w-xl md:max-w-2xl lg:max-w-4xl xl:max-w-6xl;
}

/* ─── Flow content rhythm ─── */
:is(p, ul, ol, blockquote, figure, table, dl, pre, details, fieldset, hr)
  + :is(p, ul, ol, blockquote, figure, table, dl, pre, details, fieldset, hr) {
  margin-top: 1rem;
}

/* ─── Form field group spacing ─── */
:is(input:not([type="hidden"]), textarea, select, small) + label {
  @apply mt-4;
}

/* ─── Typography ─── */
:scope {
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
  font-size: 17px;
  line-height: 1.47;
  letter-spacing: -0.015em;
  color: var(--color-foreground);
}
h1 {
  @apply font-bold text-foreground mb-4;
  font-size: 34px;
  line-height: 1.21;
  letter-spacing: -0.003em;
  &:not(:first-child) { @apply mt-8; }
}
h2 {
  @apply font-semibold text-foreground mb-3;
  font-size: 22px;
  line-height: 1.18;
  letter-spacing: 0.016em;
  &:not(:first-child) { @apply mt-8; }
}
h3 {
  @apply font-semibold text-foreground mb-2;
  font-size: 20px;
  line-height: 1.25;
  letter-spacing: 0.019em;
  &:not(:first-child) { @apply mt-6; }
}
h4 {
  @apply font-semibold text-foreground mb-1;
  font-size: 17px;
  line-height: 1.29;
  letter-spacing: -0.022em;
  &:not(:first-child) { @apply mt-4; }
}
a {
  @apply font-normal text-primary no-underline;
  &:hover { @apply underline underline-offset-4; text-decoration-color: var(--color-primary); }
}
ul {
  @apply list-disc pl-6 space-y-1.5;
}
ol {
  @apply list-decimal pl-6 space-y-1.5;
}
blockquote {
  @apply border-l-2 pl-5 italic text-muted-foreground;
  border-color: var(--color-border-solid);
}
code {
  @apply rounded-md bg-secondary px-1.5 py-0.5 font-mono text-[13px] font-medium;
}

/* ─── Figure ─── */
figure {
  & img {
    @apply rounded-xl w-full;
    corner-shape: squircle;
  }
  & figcaption {
    @apply mt-2 text-center text-sm text-muted-foreground;
  }
}

/* ─── Details / Summary ─── */
details {
  @apply rounded-xl border p-5;
  corner-shape: squircle;
  border-color: var(--color-border);
  & summary {
    @apply cursor-pointer font-semibold text-foreground;
    &::marker { color: var(--color-muted-foreground); }
  }
  & > :not(summary):not(:first-child) { @apply mt-3; }
}

/* ─── Pre / Code block ─── */
pre {
  @apply rounded-xl p-4 text-[13px] overflow-x-auto;
  corner-shape: squircle;
  background: var(--surface-2);
  & > code {
    @apply bg-transparent p-0 rounded-none text-inherit;
    font: inherit;
  }
}

/* ─── Text inputs ─── */
/* [type="range"] styled in slider.css; [type="file"] intentionally unstyled */
input:where(:not([type="checkbox"]):not([type="radio"]):not([type="range"]):not([type="file"]):not([type="submit"]):not([type="reset"]):not([type="button"]):not([type="image"]):not([type="hidden"]):not([role="switch"])) {
  @apply w-full h-11 rounded-[12px] border px-4 text-[13px] text-foreground outline-none;
  corner-shape: squircle;
  background-color: var(--color-card);
  border-color: var(--input-border);
  transition: border-color 0.2s var(--apple-ease), box-shadow 0.2s var(--apple-ease);
  &::placeholder { @apply text-muted-foreground; opacity: 0.45; }
  &:hover:not(:focus) { border-color: var(--input-border-hover); }
  &:focus { border-color: var(--color-primary); box-shadow: 0 0 0 3px oklch(from var(--color-primary) l c h / 0.15); }
  &:disabled { @apply cursor-not-allowed opacity-50; }
  &[aria-invalid="true"] { border-color: var(--color-destructive); &:focus { border-color: var(--color-destructive); box-shadow: 0 0 0 3px oklch(from var(--color-destructive) l c h / 0.15); } }
}

/* ─── Textarea ─── */
textarea {
  @apply w-full rounded-[12px] border px-3.5 py-3 text-[13px] text-foreground outline-none;
  corner-shape: squircle;
  background-color: var(--color-card);
  border-color: var(--input-border);
  transition: border-color 0.2s var(--apple-ease), box-shadow 0.2s var(--apple-ease);
  &::placeholder { @apply text-muted-foreground; opacity: 0.45; }
  &:hover:not(:focus) { border-color: var(--input-border-hover); }
  &:focus { border-color: var(--color-primary); box-shadow: 0 0 0 3px oklch(from var(--color-primary) l c h / 0.15); }
  &:disabled { @apply cursor-not-allowed opacity-50; }
  &[aria-invalid="true"] { border-color: var(--color-destructive); &:focus { border-color: var(--color-destructive); box-shadow: 0 0 0 3px oklch(from var(--color-destructive) l c h / 0.15); } }
}

/* ─── Select ─── */
select {
  @apply w-full h-11 rounded-[12px] border appearance-none pl-3.5 pr-10 text-[13px] text-foreground outline-none;
  corner-shape: squircle;
  background-color: var(--color-card);
  border-color: var(--input-border);
  transition: border-color 0.2s var(--apple-ease), box-shadow 0.2s var(--apple-ease);
  /* Chevron SVG — light: #6E6E73 (--color-muted-foreground), dark: #98989D */
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236E6E73' stroke-width='2'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 0.75rem center;
  background-size: 1rem;
  .dark & {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2398989D' stroke-width='2'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'/%3E%3C/svg%3E");
  }
  &:hover:not(:focus) { border-color: var(--color-border-solid); }
  &:focus { border-color: var(--color-primary); box-shadow: 0 0 0 3px oklch(from var(--color-primary) l c h / 0.15); }
  &:disabled { @apply cursor-not-allowed opacity-50; }
  &[aria-invalid="true"] { border-color: var(--color-destructive); &:focus { border-color: var(--color-destructive); box-shadow: 0 0 0 3px oklch(from var(--color-destructive) l c h / 0.15); } }
}

/* ─── Checkbox ─── */
input[type="checkbox"]:not([role="switch"]) {
  @apply appearance-none shrink-0 rounded-[5px] border bg-card cursor-pointer;
  width: 18px;
  height: 18px;
  border-color: var(--input-border);
  transition: all 0.2s var(--apple-ease);
  &:checked {
    @apply bg-primary border-primary;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='white' stroke-width='3'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M5 13l4 4L19 7'/%3E%3C/svg%3E");
    background-size: 10px;
    background-position: center;
    background-repeat: no-repeat;
  }
  &:focus-visible { box-shadow: 0 0 0 3px oklch(from var(--color-primary) l c h / 0.15); }
  &:hover:not(:checked) { border-color: var(--input-border-hover); }
  &:active:not(:disabled) { transform: scale(0.9); }
  &:disabled { @apply cursor-not-allowed opacity-50; }
}

/* ─── Radio ─── */
input[type="radio"] {
  @apply appearance-none shrink-0 rounded-full border bg-card cursor-pointer;
  width: 18px;
  height: 18px;
  border-color: var(--input-border);
  transition: all 0.2s var(--apple-ease);
  &:checked {
    border-color: var(--color-primary);
    border-width: 5px;
  }
  &:focus-visible { box-shadow: 0 0 0 3px oklch(from var(--color-primary) l c h / 0.15); }
  &:hover:not(:checked) { border-color: var(--input-border-hover); }
  &:active:not(:disabled) { transform: scale(0.9); }
  &:disabled { @apply cursor-not-allowed opacity-50; }
}

/* ─── Switch ─── */
input[type="checkbox"][role="switch"] {
  @apply appearance-none relative shrink-0 rounded-full cursor-pointer;
  width: 51px;
  height: 31px;
  background: var(--surface-5);
  transition: background-color 0.25s var(--apple-ease);
  &::after {
    content: "";
    @apply absolute rounded-full bg-white;
    top: 2px;
    left: 2px;
    width: 27px;
    height: 27px;
    box-shadow: 0 2px 4px oklch(0 0 0 / 0.15), 0 1px 2px oklch(0 0 0 / 0.1);
    transition: transform 0.25s var(--apple-spring);
  }
  &:checked {
    background: var(--color-primary);
    &::after { transform: translateX(20px); }
  }
  &:focus-visible { box-shadow: 0 0 0 3px oklch(from var(--color-primary) l c h / 0.15); }
  &:disabled { @apply cursor-not-allowed opacity-50; }
  .dark & {
    &:checked { background: var(--color-primary); }
    &::after {
      box-shadow: 0 2px 4px oklch(0 0 0 / 0.4), 0 1px 2px oklch(0 0 0 / 0.3);
    }
  }
}

/* ─── Label ─── */
label {
  @apply block text-[13px] font-medium text-foreground;
  &:has(input[type="checkbox"], input[type="radio"]) {
    @apply flex items-center gap-2.5 cursor-pointer;
    &:has(> small) {
      display: grid;
      grid-template-columns: auto 1fr;
      column-gap: 0.625rem;
      row-gap: 0.25rem;
      align-items: start;
      & > input { @apply mt-0.5; }
      & > small { grid-column: 2; }
    }
  }
  &:has(input:disabled) {
    @apply cursor-not-allowed opacity-50;
  }
}
label:has(+ :is(input, textarea, select):required)::after {
  content: " *";
  color: var(--color-destructive);
}
label + input, label + textarea, label + select {
  @apply mt-1.5;
}
input + small, textarea + small, select + small {
  @apply mt-1.5;
}
:is(input, textarea, select)[aria-invalid="true"] + small {
  @apply text-destructive;
}

/* ─── Table ─── */
table {
  @apply w-full text-left text-[13px] rounded-2xl bg-card;
  border-collapse: separate;
  border-spacing: 0;
  corner-shape: squircle;
  box-shadow: var(--shadow-sm), var(--panel-ring);
  & thead tr {
    border-bottom: 1px solid var(--panel-border);
    background: var(--surface-1);
  }
  & thead tr:first-child th:first-child {
    border-top-left-radius: 1rem;
    corner-shape: squircle;
  }
  & thead tr:first-child th:last-child {
    border-top-right-radius: 1rem;
    corner-shape: squircle;
  }
  & th {
    @apply px-4 py-3 text-xs font-semibold text-muted-foreground;
  }
  & tbody tr + tr {
    border-top: 1px solid var(--surface-3);
  }
  & td {
    @apply px-4 py-3;
  }
  & tbody tr {
    transition: background-color 0.2s var(--apple-ease);
    &:hover { background: var(--surface-1); }
    &[data-selected], &[aria-selected="true"] { background: oklch(from var(--color-primary) l c h / 0.1); }
  }
  & tfoot tr {
    border-top: 1px solid var(--panel-border);
    background: var(--surface-1);
  }
  & tfoot tr:last-child td:first-child {
    border-bottom-left-radius: 1rem;
    corner-shape: squircle;
  }
  & tfoot tr:last-child td:last-child {
    border-bottom-right-radius: 1rem;
    corner-shape: squircle;
  }
  & tbody:last-child tr:last-child td:first-child {
    border-bottom-left-radius: 1rem;
    corner-shape: squircle;
  }
  & tbody:last-child tr:last-child td:last-child {
    border-bottom-right-radius: 1rem;
    corner-shape: squircle;
  }
  &.table-striped tbody tr:nth-child(even) {
    background: var(--surface-1);
  }
  &.table-striped tbody tr:hover {
    background: var(--surface-2);
  }
}

/* ─── Separator (hr) ─── */
hr {
  @apply shrink-0 h-px w-full border-none;
  background: var(--panel-border);
}

/* ─── Kbd ─── */
kbd {
  @apply inline-flex h-5 min-w-5 items-center justify-center rounded-[5px] px-1.5 text-[11px] font-medium text-muted-foreground;
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
  background: var(--surface-3);
  box-shadow: 0 1px 0 var(--panel-border), var(--float-ring), inset 0 1px 0 oklch(1 0 0 / 0.15);
}

/* ─── Progress ─── */
progress {
  @apply block h-1.5 w-full overflow-hidden rounded-full appearance-none;
  background: var(--surface-4);
  &::-webkit-progress-bar {
    background: var(--surface-4);
    border-radius: 9999px;
  }
  &::-webkit-progress-value {
    background: var(--color-primary);
    border-radius: 9999px;
    transition: width 0.5s var(--apple-spring);
  }
  &::-moz-progress-bar {
    background: var(--color-primary);
    border-radius: 9999px;
  }
}

/* ─── Fieldset ─── */
fieldset {
  @apply rounded-xl border p-5;
  corner-shape: squircle;
  border-color: var(--color-border);
  & > legend {
    @apply px-2 text-[13px] font-semibold text-foreground;
  }
  @apply space-y-4;
  &:has(input[type="checkbox"], input[type="radio"]) {
    @apply space-y-2.5;
  }
}

/* ─── Small (helper text) ─── */
small {
  @apply text-xs text-muted-foreground;
}

/* ─── Description list ─── */
dl {
  @apply grid gap-x-6 gap-y-3;
  grid-template-columns: auto 1fr;
}
dt {
  @apply font-semibold text-foreground;
}
dd {
  @apply text-muted-foreground;
}

/* ─── Mark (highlight) ─── */
mark {
  @apply rounded-sm px-1 py-0.5;
  background: var(--mark-bg);
  color: var(--color-foreground);
}

/* ─── Abbreviation ─── */
abbr[title] {
  @apply cursor-help;
  text-decoration: underline dotted;
  text-decoration-color: var(--color-muted-foreground);
  text-underline-offset: 3px;
}
